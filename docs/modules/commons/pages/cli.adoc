:tabs-sync-option:

= CLI

In scope of this article the `task` term is a piece of work that is done on stories, scenarios, steps and other entities
and that produces some output based on the work done.

.The format of a task
[source,shell]
----
./gradlew <task to perform>
----

.The format of a task with arguments
[source,shell]
----
./gradlew <task to perform> --args='<arguments to pass into the task>'
----

NOTE: The tasks are available only through the `gradlew` command.

== Run stories

The task runs test stories based on current xref:configuration:tests-configuration.adoc[tests configuration] and tests state
on the file system:

:task-name: runStories
include::partial$stories-exec.adoc[]

== Debug stories

The task runs test stories omitting VIVIDUS initialization check based on current xref:configuration:tests-configuration.adoc[tests configuration]
and tests state on the file system.

:task-name: debugStories
include::partial$stories-exec.adoc[]

== Print available steps

The task prints all the steps that are available for the xref:configuration:tests-configuration.adoc[configured] profiles, environments and suites in the alphabetical order.

.Options
[cols="3,1,1,1", options="header"]
|===

|Description
|Short notation
|Full notation
|Default value

|Path to a file to save the list of the available steps
|f
|file
|by default steps are printed into the console

|===

[tabs]
======
macOS / Linux::
+
[source,shell]
----
./gradlew printSteps --args='-f my-steps.txt'
----

Windows::
+
[source,shell]
----
gradlew printSteps --args='-f my-steps.txt'
----
======

.Output
[source,gherkin]
----
vividus                                             Then `$value` matches `$regex`
vividus-plugin-web-app                              When I switch back to page
vividus-plugin-web-app                              When I press $keys on keyboard
                            COMPOSITE IN STEPS FILE Then an element with the name '$elementName' exists
                            COMPOSITE IN STEPS FILE When I click on an image with the name '$imageName'

----

== Count steps

The task counts steps in the specified tests folder and prints them in the descending order.

.Options
[cols="3,1,1,1", options="header"]
|===

|Description
|Short notation
|Full notation
|Default value

|Directory to count steps
|d
|dir
|story

|Number of steps to print
|t
|top
|<no limits by default>

|===

[tabs]
======
macOS / Linux::
+
[source,shell]
----
./gradlew countSteps --args='-t 5 -d story/uat'
----

Windows::
+
[source,shell]
----
gradlew countSteps --args='-t 5 -d story/uat'
----
======

.Output
[source,gherkin]
----
Top of the most used steps:                                                                  occurrence(s)
Then `$variable1` is $comparisonRule `$variable2`                                                      330
Given I am on page with URL `$pageURL`                                                                 127
Then number of elements found by `$locator` is $comparisonRule `$quantity`                             110
Given I initialize $scopes variable `$variableName` with value `$variableValue`                         83
When I change context to element located `$locator`                                                     59
----

== Count scenario

The task counts and prints stories, scenarios and scenarios containing examples found in the specified tests folder.

.Options
[cols="3,1,1,1", options="header"]
|===

|Description
|Short notation
|Full notation
|Default value

|Directory to count stories and scenarios
|d
|dir
|story

|===

[tabs]
======
macOS / Linux::
+
[source,shell]
----
./gradlew countScenarios --args='-d story/uat'
----

Windows::
+
[source,shell]
----
gradlew countScenarios --args='-d story/uat'
----
======

.Output
[source]
----
5  | Stories
13 | Scenarios
6  | Scenarios with Examples
----

== Validate known issues configuration

The task validates known issues format and prints the validated known issues into the console.

[tabs]
======
macOS / Linux::
+
[source,shell]
----
./gradlew validateKnownIssues
----

Windows::
+
[source,shell]
----
gradlew validateKnownIssues
----
======

.Output
[source]
----
Known issues found:
VVD-5
VVD-6
VVD-7
VVD-8
----

== Find known issues by assertion pattern

The task used to find known issues contained in the test project by one or more assertion patterns.

.Options
[cols="3,1,1,1", options="header"]
|===

|Description
|Short notation
|Full notation
|Default value

|Required path to a file that contains new-line-separated list of assertion patterns
|f
|file
|<no default value>

|===

IMPORTANT: If you miss the file argument into the task it will behave as described per <<_validate_known_issues_configuration>>

.assertion-patterns.txt
[source]
----
.*Doctor Who.*
----

[tabs]
======
macOS / Linux::
+
[source,shell]
----
./gradlew validateKnownIssues --args='-f ./assertion-failures.txt'
----

Windows::
+
[source,shell]
----
gradlew validateKnownIssues --args='-f assertion-failures.txt'
----
======

.Output
[source]
----
Known Issue | Assertion Error
VVD-6       | .*Doctor Who.*
----

== Replace deprecated steps

The task replaces deprecated steps with actual ones in all stories(`\*.story` files) and composite steps (`*.steps` files) along the path `<project-name>/src/main/resources`.
Please note that some deprecated steps (for example which should be replaced with two steps) cannot be replaced automatically and must be refactored manually.

[tabs]
======
macOS / Linux::
+
[source,shell]
----
./gradlew replaceDeprecatedSteps
----

Windows::
+
[source,shell]
----
gradlew replaceDeprecatedSteps
----
======

.Output (for cases when found steps which cannot be replaced automatically)
[source]
----
The step "When I check all checkboxes located by `xpath(.//input)`" from "CheckboxStepsTests.story - Scenario: Validation of step 'When I $checkboxState all checkboxes located by `$checkboxesLocator`'" is deprecated but cannot be replaced automatically, please replace it manually.
The step "When I check all checkboxes located by `xpath(.//input)`" from "composite.steps - Composite: When I run composite step with table:$table" is deprecated but cannot be replaced automatically, please replace it manually.
----

== Replace deprecated properties

The task replaces deprecated properties with actual ones in all properties files along the path `<project-name>/src/main/resources/properties`.

[tabs]
======
macOS / Linux::
+
[source,shell]
----
./gradlew replaceDeprecatedProperties
----

Windows::
+
[source,shell]
----
gradlew replaceDeprecatedProperties
----
======

The examples below demonstrate property file with deprecated properties before and after applying the `replaceDeprecatedProperties` task.

.Property file with deprecated entries before running the task `replaceDeprecatedProperties`
[source]
----
ui.visual.applitools.server-uri=https://eyes.applitools.com/
ui.visual.applitools.app-name=name
web.driver.CHROME.experimental-options={"prefs": {"profile": {"cookie_controls_mode": 0}}}
batch-6.story-execution-timeout=PT15M
----

.Property file with replaced entries after running the task `replaceDeprecatedProperties`
[source]
----
applitools.server-uri=https://eyes.applitools.com/
applitools.app-name=name
web.driver.chrome.experimental-options={"prefs": {"profile": {"cookie_controls_mode": 0}}}
batch-6.story.execution-timeout=PT15M
----

== Find and fix formatting issues (Spotless checks)

Spotless checks refer to code formatting and linting validations performed by the https://github.com/diffplug/spotless[Spotless], a tool designed to enforce consistent code quality standards. Spotless automates the formatting of files based on predefined rules and integrates with linting tools.

Spotless offers a number of generic formatters (indentation correction, normalize line endings, enforce consistent EOF files, enforce file encoding, normalize quotes, remove debugging or unnecessary comments, sort imports/dependencies, etc.) that can help enforce consistent code hygiene in your project. These formatting rules are versatile and can be applied to any type of file, ensuring your codebase is clean and professional.

=== Spotless in test automation

For files like *.story, *.steps, *.table, commonly used in VIVIDUS, basic Spotless rules typically include:

.Spotless rules
[cols="1,2", options="header"]
|===
|Rule
|Description

|Trimming Trailing Whitespace
|Removes any spaces or tabs at the end of lines.

|Ensuring Newline at End of File
|Guarantees that each file ends with a single newline.

|Consistent Indentation
|Enforces 4 spaces for indentation.

|Normalizing Line Endings
|Converts all line endings to LF (\n) for consistency across platforms.

|===

These rules help keep test files clean, readable, and consistent, reducing noise in version control and making collaboration easier.

=== Key Spotless tasks

The task validates that all files comply with the specified formatting rules.

NOTE: This task is performed automatically during the build process and does not require any manual initiation.

[tabs]
======
macOS / Linux::
+
[source,shell]
----
./gradlew spotlessCheck
----

Windows::
+
[source,shell]
----
gradlew spotlessCheck
----
======

The task automatically formats files to conform to the defined rules.

[tabs]
======
macOS / Linux::
+
[source,shell]
----
./gradlew spotlessApply
----

Windows::
+
[source,shell]
----
gradlew spotlessApply
----
======

=== Build failure due to format violations

If you execute the `build` task and encounter the following result:

[source,shell]
----
FAILURE: Build failed with an exception.

* What went wrong:
Execution failed for task ':spotlessVividusCheck'.
> The following files had format violations:
      bin/main/story/web_app/Google Search.story
          @@ -16,4 +16,3 @@
           When·I·wait·until·element·located·by·`<search-button>`·appears
           When·I·click·on·element·located·by·`<search-button>`
           Then·number·of·elements·found·by·`linkUrlPart(https://docs.vividus.dev/vividus/)->filter.textPart(What·is·VIVIDUS·::·VIVIDUS)`·is·equal·to·`1`
          -
      src/main/resources/story/web_app/Google Search.story
          @@ -16,4 +16,3 @@
           When·I·wait·until·element·located·by·`<search-button>`·appears
           When·I·click·on·element·located·by·`<search-button>`
           Then·number·of·elements·found·by·`linkUrlPart(https://docs.vividus.dev/vividus/)->filter.textPart(What·is·VIVIDUS·::·VIVIDUS)`·is·equal·to·`1`
          -
----

You will also see a message in your shell like this:

[source,shell]
----
Run './gradlew :spotlessApply' to fix these violations.
----

Review the changes that were applied after the suggested command execution and commit them to your repository.
By following these steps, you will ensure your build is stable and successful.
