= How to create VIVIDUS automated tests with the help of AI

VIVIDUS offers MCP server that exposes core VIVIDUS functionalities to LLMs via the
https://modelcontextprotocol.io/docs/getting-started/intro[MCP protocol], enabling generation of automated
test scenarios leveraging those capabilities.

IMPORTANT: LLM will access only those steps that are available from plugins included into your test project.

== Install MCP server

. Copy the below line to `dependencies` section of the project `build.gradle` file in your test project
+
[IMPORTANT]
VIVIDUS MCP server is available starting from version `0.6.16-SNAPSHOT` and higher.
+
.build.gradle
[source,gradle,subs="attributes+"]
----
implementation('org.vividus:vividus-mcp-server')
----
. Make sure to use https://github.com/vividus-framework/vividus-build-system?tab=readme-ov-file#migrating-from-20-to-30[Build System 3.0]
. Update `gradlew` script in the root of your test project to the latest version:
.. Go to https://github.com/vividus-framework/vividus-starter/blob/main/gradlew
.. Copy content of the `gradlew` script
.. Replace the content of the `gradlew` script in the root of the test project with the copied content

. If the project was imported to the IDE before adding new dependency,
xref:ROOT:getting-started.adoc#_use_ide_for_the_tests_development[re-generate]
the configuration files for the used IDE and then refresh the project in the used IDE.

== Configure AI Assistant

[#configure-mcp-servers]
.GitHub Copilot in VS Code
[%collapsible]
====
. Install https://code.visualstudio.com/download[Visual Studio Code]
. Open the project with VIVIDUS tests in Visual Studio Code
. https://code.visualstudio.com/docs/copilot/setup#_set-up-copilot-in-vs-code[Set up Copilot in VS Code] if it is not done yet
. Create a new file at path `/.vscode/mcp.json` in the root of the project
. Add the following configuration into `mcp.json` file and save it
+
[tabs]
======
macOS / Linux::
+
[source,json]
----
{
  "servers": {
    "vividus": {
      "command": "/Users/Bob/Workspace/vividus-sample-tests/gradlew", <1>
      "args": [
        "startMcpServer",
        "-q",
        "-p",
        "/Users/Bob/Workspace/vividus-sample-tests" <2>
      ]
    },
    "playwright": { <3>
      "command": "npx",
      "args": [
        "@playwright/mcp@latest"
      ]
    }
  }
}
----

Windows::
+
[source,json]
----
{
  "servers": {
    "vividus": {
      "command": "c:\\Users\\Bob\\Workspace\\vividus-sample-tests\\gradlew.bat", <1>
      "args": [
        "startMcpServer",
        "-q",
        "-p",
        "c:\\Users\\Bob\\Workspace\\vividus-sample-tests" <2>
      ]
    },
    "playwright": { <3>
      "command": "npx",
      "args": [
        "@playwright/mcp@latest"
      ]
    }
  }
}
----
======
+
<1> The absolute path to the `gradlew` or `gradlew.bat` executable contained in the tests project
<2> The absolute path to the tests project
<3> The Playwright MCP server is optional and can be used to control browser and generate tests for web-applications
. Start the MCP servers by clicking on the `▷ Start` buttons on the top of the servers names
. Use Copilot in https://code.visualstudio.com/docs/copilot/chat/chat-agent-mode#_use-agent-mode[agent mode] to generate automated scenarios
====

.Claude Desktop
[%collapsible]
====
Claude is a next generation AI assistant built by Anthropic and trained to be safe, accurate, and secure to help you do your best work.

. Install https://claude.ai/download[Claude Desktop]
. Open `Claude Desktop` and navigate to `Developer` tab in application `Settings`
. Click `Edit Config` which opens `claude_desktop_config.json` file that contains MCP server configs
. Add the following configuration into `claude_desktop_config.json` file and save it
+
[tabs]
======
macOS / Linux::
+
[source,json]
----
{
  "mcpServers": {
    "vividus": {
      "command": "/Users/Bob/Workspace/vividus-sample-tests/gradlew", <1>
      "args": [
          "startMcpServer",
          "-q",
          "-p",
          "/Users/Bob/Workspace/vividus-sample-tests" <2>
      ]
    },
    "playwright": { <3>
      "command": "npx",
      "args": [
          "@playwright/mcp"
      ]
    }
  }
}
----

Windows::
+
[source,json]
----
{
  "mcpServers": {
    "vividus": {
      "command": "c:\\Users\\Bob\\Workspace\\vividus-sample-tests\\gradlew.bat", <1>
      "args": [
          "startMcpServer",
          "-q",
          "-p",
          "c:\\Users\\Bob\\Workspace\\vividus-sample-tests" <2>
      ]
    },
    "playwright": { <3>
      "command": "npx",
      "args": [
          "@playwright/mcp"
      ]
    }
  }
}
----
======
+
<1> The absolute path to the `gradlew` or `gradlew.bat` executable contained in the tests project
<2> The absolute path to the tests project
<3> The Playwright MCP server is optional and can be used to control browser and generate tests for web-applications
. Restart `Claude Desktop` application
====

== Web-application test automation with GitHub Copilot in VS Code

=== Prerequisites

. Switch to chat https://code.visualstudio.com/docs/copilot/chat/chat-agent-mode#_use-agent-mode[agent mode]
. Choose the preferred Language Model (the list of the available models can differ depending on your license)
. Configure and start the <<configure-mcp-servers, MCP servers>>

=== Common Prompt Files

A prompt file stores stable instructions and constraints for the AI agent. Use it to fix style, allowed steps,
locator conventions, and validation rules so every generated test follows team standards.

Benefits of prompt file usage:

* Centralized rules for test generation.
* Reusable across test creation sessions.
* Easier auditing and refactoring when the rules change.

==== Setup prompt files for GitHub Copilot

.   Create a `.github/prompts` folder (if it doesn't exist)
.   Place the ready-made prompt files into the created folder. The sample prompt for generating VIVIDUS stories that test web-applications is available in the https://github.com/vividus-framework/vividus-sample-tests/blob/main/.github/prompts/generate-vividus-story-web.prompt.md[sample project]; copy this content into your local project and then modify it based on your needs and the specifics of your SUT.
+
[IMPORTANT]
The prompt file must have the `.prompt.md` extension (e.g., `generate-vividus-story-web.prompt.md`). This extension ensures proper
recognition by VS Code and GitHub Copilot
+
.   Specify the path to your tests folder in the prompt.
.   https://code.visualstudio.com/docs/copilot/customization/prompt-files#_use-a-prompt-file-in-chat[Use a prompt file in chat].


== Writing Tests with AI Assistance

.Combine the prompt configured earlier with a detailed test case:
```
Open `https://example.com/` page.
Close any opened pop-ups.
Check Search functionality.
```

This will generate a test with:

*  Browser initialization.
*  URL navigation.
*  Pop-up handling.
*  Search functionality verification.

.Or combine the prompt configured earlier with general web testing scenarios (scenarios list generated by AI):
```
Open `https://example.com/` page and write test automation scenarios demonstrating Vividus tool capabilities for web application testing.
```

This will generate multiple scenarios covering:

*  Page navigation.
*  Basic element interactions.
*  Key elements verification.

=== Best Practices for AI Test Generation

.  **Be Specific**: Include exact URLs and scope details.
.  **State Requirements**: Mention specific validations needed.
.  **Indicate Patterns or Approaches**.
.  **Store Common Prompt Logic**: Save common prompt logic in a separate prompt file to avoid copy-pasting across
different chats and minimize session context expiration effects.

== FAQ

=== Q: How to execute my tests automatically after creation?

[IMPORTANT]

Please be aware of token limits. Set up auto-execution only if you are confident and polish your prompt file.

Extension of prompt `test-template.prompt.md` file to include auto-run of test cases after confirmation in chat:

```
After generating the test script:
1. Confirm test execution in agent chat by `"Yes, execute the tests"`.
2. Execute test using сommand: ./gradlew runStories
3. Automatically execute test with:
   - Chrome desktop profile.
   - Newly created story files.
   - Real-time execution logs.
4. Provide results in the chat showing:
   - Execution status.
   - Test results summary.
   - Any failures or errors.
   - Link to a detailed report.
```

[NOTE]

Tests will only run after explicit confirmation to ensure the script is ready for execution.

=== Q: How to set up recursive updates of steps by AI?

[IMPORTANT]

Please be aware of token limits. Send only the relevant story (add context).

Due to token limitations, break down large test suites:

*  Update scenarios in small batches (3-5 at a time).
*  Use intermediate commits.
*  Request focused updates.

.Prompt to add recursive test scenarios update:
```
Update test scenarios to include enhanced logging and error handling, focusing on the login flow
```

=== Q: How to combine several cases written by AI in different files?

Combining Strategies:

*  Extract common steps to separate scenario.
*  Create composite steps.
*  Use story includes.

.Prompt for file combination:
```
Combine these test scenarios into a single story file, extract common steps into separate scenario, and create composite steps for repeated actions.
```

=== Q: How to refactor existing code with AI help?

[IMPORTANT]

Please be aware of token limits. If you need a full refactor, split the work into multiple passes.

Refactoring Approaches:

*  Share existing code with AI (add context).
*  Request specific improvements.
*  Apply design patterns.
+
[tabs]
======
BDD::
+
[source]
----
Refactor these test scenarios to follow BDD approach and extract common steps into composite steps.
----

DDD::
+
[source]
----
Refactor these test scenarios to follow DDD approach and add examples tables to add variety of test data.
----
======

=== Q: What to do when AI starts hallucinating after previously working well?

**Symptoms:**

*  Generated steps don't match Vividus step list.
*  Incorrect locator formats (not using id/xpath as specified).
*  Invalid syntax or made-up parameters.
*  Attempts to execute non-existent commands.
*  Creates invalid file structures.

Immediate Actions:

.  Stop current generation.
.  Clear the conversation.
.  Start fresh with URL and requirements (use `test-template.prompt.md` or provide details in chat).
